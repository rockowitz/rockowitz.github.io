<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Sanford Rockowitz" /><link rel="canonical" href="https://www.ddcutil.com/c_api_220/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Shared Library Changes for Release 2.2.0 - ddcutil Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Shared Library Changes for Release 2.2.0";
        var mkdocs_page_input_path = "c_api_220.md";
        var mkdocs_page_url = "/c_api_220/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> ddcutil Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../commands/">Command Overview</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Command Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cmd_output/">Command Examples</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../detect_verbose_output/">ddcutil detect example</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../getvcp_known_u3011_output/">ddcutil getvcp example</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../vcpinfo_output/">ddcutil vcpinfo example</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cap_u3011_verbose_output/">ddcutil capabilities example</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Command Detail</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../command_detail/">Command Detail</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../primary_commands/">Primary Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Primary Commands</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../command_detect/">detect</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../command_capabilities/">capabilities</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../command_getvcp/">getvcp</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../command_setvcp/">setvcp</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../command_vcpinfo/">vcpinfo</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../command_dumpvcp_loadvcp/">dumpvcp &amp; loadvcp</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../command_scs/">scs</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../secondary_commands/">Secondary Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../options_main/">Command Options</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Command Options</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../display_detection/">Display Detection</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../display_selection/">Display Selection</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../feature_selection/">Feature Selection</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../performance_options/">Performance and Tuning Options</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../instrumentation_options/">Instrumentation Options</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../output_control_options/">Output Level Options</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../other_options/">Miscellaneous Options</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../i2c_dev_options/">i2c-dev Driver Options</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../debug_options/">Debugging Options</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../deprecated_options/">Deprecated Options</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../libddcutil_options/">Shared Library Options</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Specific Facilities</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../table_features/">Table Type Features</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../usb/">USB Connected Monitors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../colormgt/">Color Management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../udf/">User Defined Features</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../config_file/">Configuration File</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation and Configuration</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../install_config_main/">Installation and Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../config_steps/">Post-Installation Checklist</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install/">Install ddcutil From Prebuilt Packages</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../copr_transaction_test_error/">How to fix copr transaction test error</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../building/">Building From Source</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../shared_lib_config/">Shared Library Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mult_shared_libs/">Notes for Linux Distribution Maintainers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../config/">Configuration and Installation Diagnostics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../i2c_permissions/">I2C Device Permissions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../i2c_permissions_using_group_i2c/">I2C Device Permissions Using Group i2c</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../usb_permissions/">USB Device Permissions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kernel_module/">Kernel Module Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nvidia/">Special Nvidia Driver Settings</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nvidia_old/">Setting Nvidia Driver Options Using X11</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../amdgpu/">Notes on driver amdgpu</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../virtual_machines/">Virtual Machines</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../raspberry/">Raspberry Pi</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../monitor_notes/">Notes on Specific Monitors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quirks/">Notes on Particular Configurations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../typec/">USB-C DisplayPort Alt Mode</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Shared Library</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../api_main/">C API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../libddcutil_release_notes/">Shared Library Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_90/">Shared Library Changes for Release 0.9.0</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_93/">Shared Library Changes for Release 0.9.3</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_95/">Shared Library Changes for Release 0.9.5</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_96/">Shared Library Changes for Release 0.9.6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_98/">Shared Library Changes for Release 0.9.8</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_99/">Shared Library Changes for Release 0.9.9</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_100/">Shared Library Changes for Release 1.0.0</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_110/">Shared Library Changes for Release 1.1.0</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_120/">Shared Library Changes for Release 1.2.0</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_130/">Shared Library Changes for Release 1.3.0</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_140/">Shared Library Changes for Release 1.4.0</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_200/">Shared Library Changes for Release 2.0.0</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_210/">Shared Library Changes for Release 2.1.0</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_212/">Shared Library Changes for Release 2.1.2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_213/">Shared Library Changes for Release 2.1.3</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../c_api_214/">Shared Library Changes for Release 2.1.4</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Shared Library Changes for Release 2.2.0</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#display-change-reporting">Display Change Reporting</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#general-comments">General Comments</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sleep-state-detection">Sleep State Detection</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#options-affecting-display-change-detection">Options Affecting Display Change Detection.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#api-changes">API Changes</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#other-shared-library-changes">Other Shared Library Changes</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Background</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../mccs_background/">Monitor Control Command Set</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ddc_vs_i2c/">DDC vs I2C</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../displayport/">DDC and DisplayPort</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bibliography/">References</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../devdoc/">Developer Documentation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Additional Topics</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../articles/">Articles about ddcutil</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../faq/">Frequently Asked Questions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tech_support/">Technical Support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ddccontrol/">Comparison with ddccontrol</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ddc_null_response/">DDC Null Message</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sniffing/">Reverse Engineering Proprietary DDC Extensions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../acknowledgements/">Acknowledgements</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../technotes/">Technical Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../driver_bug_reports/">Driver Bug Reports of Interest</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Release History</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../releases/">Releases</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../release_notes_220/">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../release_notes/">Prior_Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../prior_announcements/">Announcement History</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ddcui</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ddcui_main/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ddcui_options/">Command Line Options</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../building_ddcui/">Building ddcui</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ddcui_release_notes/">ddcui Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ddcui_faq/">ddcui Frequently Asked Questions</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Related Resources</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../monitor_resources/">Monitor Specifications</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../windows_programs/">Windows Utilities for Monitor Control</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mac_programs/">Macintosh Utlities for Monitor Control</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ddcutil_usage/">Applications using ddcutil</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">ddcutil Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Shared Library</li>
      <li class="breadcrumb-item active">Shared Library Changes for Release 2.2.0</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/rockowitz/ddcutil/edit/master/docs/c_api_220.md" ></a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="shared-library-changes-for-release-220">Shared Library Changes for Release 2.2.0</h2>
<p>Shared library <strong>libddcutil</strong> is backwardly compatible with the one in
ddcutil 2.1.4. The SONAME is unchanged as libddcutil.so.5. The released library
file is libddcutil.so.5.2.0.</p>
<h3 id="display-change-reporting">Display Change Reporting</h3>
<h4 id="general-comments">General Comments</h4>
<p>Detection of display connection and disconnection has been extensively reworked.
Unfortunately, multiple issues cause tradeoffs in the implementation.</p>
<ul>
<li>
<p>First, there's a tension in display change detection between minimizing the time between
  when a monitor connection/disconnection occurs, libddcutil becomes aware of the change, 
  checking and rechecinging failed states (e.g. DDC not working), and invoking the 
  client callback function to inform the client of the change.</p>
<ul>
<li>Performance impact of how aggressively <strong>libddcutil</strong> watches for changes.</li>
<li>It is possible for a monitor to briefly disappear as disconnected and then immediately 
reconnect.</li>
<li>Conversely, it's also possible for a monitor to appear, then immediately disappear
before the detection process is complete</li>
<li>There can be a delay between time the EDID can be read and DDC becomes functional. </li>
</ul>
</li>
<li>
<p>Display change detection is unreliable with the nvidia proprietary driver.</p>
<ul>
<li>The nvidia driver does not use /sys in the same way as amdgpu, i915, 
  nouveau and other drm enabled drivers that are part of the Linux kernel.  </li>
<li>Depending on driver version the phase of the moon, the /sys file system does not
  reflect display changes and UDEV events or X11 events are not generated. In that case 
  no display changes are reported.</li>
</ul>
</li>
<li>
<p>Whether a display appears to be connected depends on whether the EDID can be read.
  For DVI/HDMI devices, power to the EDID EEPROM is provided over the cable. As a result, 
  the EDID is readable so long as a cable is connected, even if the display is powered off.
  For DisplayPort devices, the EDID is readable only if the monitor is supplying it power.
  Even here, there is a difference between plugging/unplugging a monitor power cord and
  pressing the power button on the display itself.  In the latter case, whether power is 
  supplied to the EEPROM and the EDID is readable depends on the monitor implementation.</p>
</li>
<li>
<p>Depending on driver, changes in monitor state may or may not be immediately relected in /sys. </p>
</li>
<li>
<p>Connection of Multi-Stream Transport (MST) hub devices may or may not be detected depending on the driver/device combination.</p>
</li>
</ul>
<p>Consequently two algorithms. aka watch modes, exist for detecting display changes. The first is more efficient, the second more reliable:</p>
<ul>
<li>
<p>watch mode XEVENT.</p>
<p>-Scans for changes using the X11 API extension RANDR (which also works on Wayland), 
 and if possible reads the EDID from /sys. </p>
</li>
<li>
<p>watch mode POLL</p>
<ul>
<li>Attempts to read an EDID from every (plausible) /dev/i2c device in polling loop. </li>
<li>Doesn't use X11 or rely on /sys</li>
<li>Can consume a significant amount of CPU time on older machines.<ul>
<li>Users with all but the most powerful machines may find it much too resource consumptive.</li>
<li>Impact can be adjusted by reducing the polling frequency (see option <strong><em>--poll-watch-loop-millisec</em></strong>) at the expense of responsiveness.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The possibility of a delay between the time a monitor is connected and the time that DDC becomes enabled is addressed in the following way:  </p>
<ul>
<li>If a monitor is detected but DDC is not working, the display connection event is reported to the client 
with bit <strong>DDCA_DISPLAY_EVENT_DDC_NOT_WORKING</strong> set in newly added <strong>flags</strong> field, and the display reference goes onto a recheck queue processed by a separate thread.  </li>
<li>Later, there will be an event of type <strong>DDCA_EVENT_DDC_ENABLED</strong> if and when the recheck thread determines that DDC is working.</li>
</ul>
<h4 id="sleep-state-detection">Sleep State Detection</h4>
<ul>
<li>Detecting and reporting sleep mode proved very problematic. <strong>libddcutil</strong> no longer watches 
  for and reports changes to DPMS state.  However, if an API function is called to perform an operation that requires communiation with a display 
  that is asleep, status <strong>DDCRC_DPMS_ASLEEP</strong> is returned.   </li>
</ul>
<h4 id="options-affecting-display-change-detection">Options Affecting Display Change Detection.</h4>
<p>Typically, these options are added to the <strong>[libddcutil]</strong> section of configuration
file ddcutilrc. They can also be included in the opts argument string passed to <strong>ddca_init2()</strong>.</p>
<ul>
<li>
<p><strong><em>--watch-mode XEVENT, POLL, DYNAMIC</em></strong> (default DYNAMIC) Specifies the watch 
  algorithm to be used. DYNAMIC resolves to XEVENT if it appears that algorithm 
  will work, otherwise it resolves to POLL.</p>
</li>
<li>
<p><strong><em>--enable-try-get-edid-from-sysfs</em></strong> (default), <strong><em>--disable-try-get-edid-from-sysfs</em></strong>.
  Get the EDID from /sys if possible instead of reading it from the display.
  This can improve performance, but may affect of reliability.</p>
</li>
<li>
<p><strong><em>--xevent-watch-loop-millisec</em></strong>.  Override the interval for watch-mode XEVENT at whcih libddcutil checks
  for an X11 screen change notification. Default: 100 milliseconds</p>
</li>
<li>
<p><strong><em>--poll-watch-loop-millisec</em></strong>.  Override the interval for watch-mode POLL at which libddcutil attempts to read 
  an EDID from every /dev/i2c device.  Default: 2000 milliseconds.</p>
</li>
<li>
<p><strong><em>--disable-watch-displays</em></strong>. Completely disables display change detection. 
  This blocks <strong>ddca_start_watch_displays()</strong> from starting the threads that watch
  for display changes.  Workaround for github issue <a href="https://github.com/rockowitz/ddcutil/issues/470">470</a>.
  Unlike the use of KDE Plasma environment variable POWERDEVIL_NO_DDCUTIL=1, this disables display change detection
  while leaving other <strong>libddcutil</strong> services available.</p>
</li>
<li>
<p><strong><em>--ignore-mmid <monitor model id></em></strong>. Exclude a specific monitor model from display change detection.
  The argument for this option is a monitor model id, e.g. e.g. SAM-U32H75x-3587. 
  The monitor model id can be found in the output of   command <strong>ddcutil detect --verbose</strong>, and is the 
  same monitor model id that is used in the name of a user defined features file. 
  This option exists because some monitors behave in ways that make KDE PowerDevil unstable. 
  See, for example, ddcutil github issue <a href="https://github.com/rockowitz/ddcutil/issues/466">466:Samsung Odyssey G5 S27DG50: Setting brightness causes monitor to crash</a>,
  github issue <a href="https://github.com/rockowitz/ddcutil/issues/470">470:DDCA_EVENT_DPMS_AWAKE sent shortly after DDCA_EVENT_DPMS_ASLEEP</a>,
  and KDE bug <a href="https://bugs.kde.org/show_bug.cgi?id=495746">495746:https://bugs.kde.org/show_bug.cgi?id=495746</a>. </p>
</li>
</ul>
<h4 id="api-changes">API Changes</h4>
<ul>
<li><strong>ddca_start_watch_displays()</strong> has been modifed (in a backwards compatible way) to reflect the fact that sleep state changes 
   are no longer reported. .  <ul>
<li>The only event class that can be enabled is DDCA_EVENT_CLASS_DISPLAY_DETECTION.  </li>
<li>DDCA_EVENT_CLASS_ALL is effectively the same as DDCA_EVENT_CLASS_DISPLAY_CONNECTION.  </li>
<li>It is an error if either DDCA_EVENT_CLASS_DPMS or DDCA_EVENT_CLASS_NONE are specified.    </li>
</ul>
</li>
<li>Struct DDCA_Display_Status_Event<ul>
<li>Add field <strong>flags</strong> in the unused secton of <strong>DDCA_Display_Status Event</strong>.  It has one bit defined, <strong>DDCA_DISPLAY_EVENT_DDC_WORKING</strong>.
Normally, this bit is set on display connection events.  In case DDC is not immediately available after 
 EDID detection, this bit is not set.  If DDC subsequently becomes enabled, an event of type DDCA_EVENT_DDC_ENABLED is emitted.</li>
</ul>
</li>
<li>
<p>Add value <strong>DDCA_EVENT_DDC_ENABLED</strong> in enum <strong>DDCA_Display_Event_Type</strong> as a possible value of field <strong>event_type</strong>.</p>
</li>
<li>
<p>Handle possible delay between time that EDID can be read and DDC becomes functional</p>
</li>
<li>
<p><strong>ddca_get_display_watch_settings()</strong>, <strong>ddca_set_display_watch_settings()</strong></p>
</li>
<li>
<p>Added value <strong>DDC_EVENT_DDC_ENABLED</strong> to enum <strong>DDCA_Event_Type</strong></p>
</li>
<li>Modified struct <strong>DDCA_Display_Status_Event</strong></li>
<li>Field <strong>event_type</strong> can take the value <strong>DDC_EVENT_DDC_ENABLED</strong>, which indicates that
    DDC communication has become enabled some time after the display was detected</li>
<li>Added field <strong>flags</strong>, with bit <strong>DDCA_DISPLAY_EVENT_DDC_WORKING</strong>. This bit is 
    normally set when <strong>event_type</strong> is <strong>DDC_EVENT_DISPLAY_CONNECTED</strong>.  If it is not
    set, it indicaets that DDC communication is not working.</li>
<li>Added <strong>ddca_get_display_watch_settings()</strong>, <strong>ddca_set_display_watch_settings()</strong>, 
  and struct <strong>DDCA_DW_Settings</strong>, enabling the client program to modify display watch
  configuration settings. </li>
</ul>
<h4 id="other-shared-library-changes">Other Shared Library Changes</h4>
<p>Quiesce operation:  </p>
<ul>
<li>Quiesce the API during <strong>ddca_redetect_displays()</strong>.  Operations that access
  display state are not permitted, and return <strong>DDCRC_QUIESCED</strong>.</li>
</ul>
<p>Status codes:  </p>
<ul>
<li>Most functions that specify a <strong>DDCA_Display_Ref</strong> now return status code 
      <strong>DDCRC_DISCONNECTED</strong> if the display reference is no longer valid.  </li>
<li>Status code <strong>DDCRC_INVALID_CONFIG_FILE</strong> has been renamed to more general <strong>DDCRC_CONFIG_ERROR</strong>, 
    and is used instead of <strong>DDCRC_BAD_DATA</strong> for User Defined Feature File errors.
    <strong>DDCRC_INVALID_CONFIG_FILE</strong> is a valid alias.</li>
</ul>
<p>System log:  </p>
<ul>
<li>Write build date and time to system log when starting <strong>libddcutil</strong>.  </li>
<li>Rework <strong>libdccutil</strong> output to avoid duplicate messages in the system log when all terminal 
  output is directed to the log, as with KDE Plasma.  </li>
<li>(Almost) all syslog messages are prefixed similarly with thread and timestamp.</li>
<li>Write syslog messages for sleeps incurred by display change detection. </li>
</ul>
<p>Miscellaneous:  </p>
<ul>
<li>
<p>Option <strong><em>--disable-api</em></strong> completely disables the API, causing most API calls, including
  those performing DDC communication, to fail. This can be useful for testing 
  whether <strong>libddcutil</strong> is the source of a system error in the case of client
  applications, e.g. KDE PowerDevil, that will not build without the shared library.</p>
</li>
<li>
<p>Use mutexes to control access to corruptable data structures, such as the table of open monitors.</p>
</li>
<li>
<p>Enum value <strong>DDCA_STATS_API</strong> is added to enum <strong>DDCA_Stats_Type</strong>, for reporting API specific statistics.</p>
</li>
<li>
<p>In some situations, it is meaningful to specify a display reference for a display that has been removed.                      </p>
<ul>
<li>During initial display reference validation, an otherwise valid display reference may be
  for a removed display.  Avoid a segfault in this case. 
  Addresses github issue <a href="https://github.com/rockowitz/ddcutil/issues/418">418:libddcutil behaves differently/fails after a hotplug compared to ddcutil</a>.</li>
<li>It is useful to create a string representation of a display reference even
  if it is no longer valid. API function <strong>ddca_dref_repr()</strong> works even if the 
  display ref is no longer valid. Addresses github <a href="https://github.com/rockowitz/ddcui/issues/55">ddcui issue 55:
ddcui-0.5.x: IOT instruction (core dumped</a>.</li>
</ul>
</li>
<li>
<p><strong>ddca_get_display_refs()</strong> and <strong>ddca_get_display_info_list2()</strong> always
  return 0, even if an error occured when examining a particular monitor. 
  Addresses github issue <a href="https://github.com/rockowitz/ddcutil/issues/417">417:libddcutil ddca_get_display_info_list2 returns DDCRC_OTHER (-3022)</a>  </p>
<ul>
<li>Errors that occur opening individual displays or reading their EDIDs are
are still reported using <strong>ddca_get_error_detail()</strong>. In addition, error
messages are written to the terminal and, depending on the current
syslog level, to the system log.  </li>
</ul>
</li>
<li>
<p>API calls <strong>ddca_get_display_refs()</strong> and <strong>ddca_get_display_info_list2()</strong> do not include displays that have been marked removed. Addresses <strong>ddcutil</strong> issue #417.</p>
</li>
<li>
<p>The opaque value of <strong>DDCA_Display_Ref</strong> is now an integer display reference id number instead of an actual pointer to the internal display reference, making it slightly more opaque.  The published type remains (void*), so no client changes should be needed.</p>
</li>
<li>
<p><strong>libddcutil</strong> maintains a table of <strong>DDCA_Display_Ref</strong>s that have been passed to the client by the API.  This table is used to further validate display references the client passes as arguments.  </p>
</li>
<li>
<p>Disable the check, in the prolog to API functions, that a monitor is not asleep.  It is possible that a display is still responsive to DDC requests in this case.  If it is not, the error will be detected when actually performing the requested operation. </p>
</li>
<li>
<p><strong>ddca_get_display_info()</strong>, which does not itself perform any DDC operations, succeeds even if DDC communication is not working.  Addresses issue <strong>ddcui</strong> issue #55.</p>
</li>
<li>
<p>Option <strong><em>--skip-ddc-checks</em></strong> sets the detected VCP version to "Unknown".  Addresses a 
  possible segfault when this option is used with display change detection.</p>
</li>
<li>
<p>Avoid hang waiting for watch thread to stop when client terminated using ctl-C.</p>
</li>
</ul>
<!--

Modified Enums      |&nbsp;
-----------------------------|---------------------
DDCA_Display_Event_Type |&nbsp;DDC_EVENT_DDC_ENABLED replaces DDCA_EVENT_UNUSED1

<br>

Modified Structs |&nbsp;Comments
-------------------------|--------------
DDCA_Display_Status_Event |&nbsp;Added field flags with bit DDCA_DISPLAY_STATUS_EVENT_WORKING
<br>

Added Structs |&nbsp;Comments
-----------------------|------------------
DDCA_DW_Settings
<br>

New API &nbsp;           &nbsp;    |&nbsp;Comments
-----------------------|-------------------
ddca_get_display_watch_settings |&nbsp;
ddca_set_display_watch_settings |&nbsp;

<br>
-->
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../c_api_214/" class="btn btn-neutral float-left" title="Shared Library Changes for Release 2.1.4"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../mccs_background/" class="btn btn-neutral float-right" title="Monitor Control Command Set">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rockowitz/ddcutil" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../c_api_214/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../mccs_background/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(false);
        });
    </script>

</body>
</html>
